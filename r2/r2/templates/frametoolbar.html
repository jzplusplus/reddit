## The contents of this file are subject to the Common Public Attribution
## License Version 1.0. (the "License"); you may not use this file except in
## compliance with the License. You may obtain a copy of the License at
## http://code.reddit.com/LICENSE. The License is based on the Mozilla Public
## License Version 1.1, but Sections 14 and 15 have been added to cover use of
## software over a computer network and provide for limited attribution for the
## Original Developer. In addition, Exhibit A has been modified to be consistent
## with Exhibit B.
## 
## Software distributed under the License is distributed on an "AS IS" basis,
## WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for
## the specific language governing rights and limitations under the License.
## 
## The Original Code is Reddit.
## 
## The Original Developer is the Initial Developer.  The Initial Developer of
## the Original Code is CondeNet, Inc.
## 
## All portions of the code written by CondeNet are Copyright (c) 2006-2009
## CondeNet, Inc. All Rights Reserved.
################################################################################
<%! 
   from r2.lib.template_helpers import static, get_domain, add_sr, panel_size
   from r2.lib.strings import Score
%>

<%inherit file="reddit.html"/>
<%namespace file="utils.html" import="plain_link, logout"/>
<%namespace file="printable.html" import="state_button, comment_button, thing_css_class, score" />

<%def name="javascript_run()">
  ${parent.javascript_run()}
  toolbar = new toolbar_p("${panel_size('expanded')}", "${panel_size('collapsed')}");
</%def>

<%def name="bodyHTML()">
<body class="toolbar">
  <div class="left-side">
    <a class="logo" target="_top" href="http://${get_domain(cname = c.cname)}/">
      <img src="${static('logo-toolbar.png')}" alt="${c.site.description or c.site.name}"
           title="${c.site.description or c.site.name}"/>
      %if thing.dorks:
        <img src="${static('dorks-toolbar.png')}"
             title="${_('caution: dorkbar detected')}"/>
      %endif
    </a>

    %if thing.link:
      ${withlink()}
    %endif
  </div>

  <div class="right-side">
    <a href="#" onclick="return toolbar.toggle_linktitle(this);">
      <img src="${static('link.png')}" height="13" width="16"
           title="${_('show url')}" alt="${_('show url')}"/>
    </a>

    <a class="serendipity popped-button"
       title="${_('load a random link')}"
       onmousedown="toolbar.push_button(this)"
       onmouseup="toolbar.pop_button(this)"
       onclick="toolbar.serendipity()"
       href="${add_sr('/random')}"
       target="_top" />
      %if c.default_sr:
        ${_("serendipity")}
      %else:
        ${"%(subreddit)s serendipity" % dict (subreddit=c.site.name)}
      %endif
    </a>

    %if c.user_is_loggedin:
      <a href="http://${get_domain(cname = c.cname)}/user/${c.user.name}"
         title="${_('visit your userpage')}"
         class="clickable" target="_top">${c.user.name}</a>
    %elif thing.link:
      <a href="${thing.loginurl}" target="_top" class="clickable">
        ${_("login / register")}
      </a>
    %endif

    <a target="_top" href="/help/toolbar">
      <img src="${static('help.png')}"
           height="11" width="11"
           alt="${_('help')}" title="${_('help')}" />
    </a>

    <a href="${thing.url}" target="_top">
      <img src="${static('kill.png')}"
           height="11" width="11"
           alt="${_('visit this link without the toolbar')}"
           title="${_('visit this link without the toolbar')}" />
    </a>
  </div>

  <div class="middle-side clickable">
    %if thing.link:
    <a
       title="${_('click to visit the main page for this submission')}"
       class="title clickable"
       target="_top"
       href="${thing.link.make_permalink_slow()}">
       ${thing.link.title}
    </a>
    %else:
      ${plain_link(_('click to submit this link to reddit'), thing.submit_url,
                      target="_top", _class="submit")}
    %endif
    <div class="url" style="display: none;">
      <form onsubmit="return toolbar.gourl(this, '${add_sr('/s/')}')">
        <input type="text" value="${thing.url}" />
      </form>
    </div>
  </div>

  <div class="toolbar-status-bar" style="display: none;">
    <div class="login-arrow" style="display: none;">
      <img src="${static('tb-loginarrow-right.png')}" class="login-arrow-right"/>
      <div class="login-arrow-left">
        <p class="login-message">
          ${_("you'll need to login or register to do that")}
        </p>
      </div>
    </div>
</body>
</%def>


<%def name="withlink()">
<span class="${thing_css_class(thing.link)}">
  ## add us to the click cookie
  <script type="text/javascript">
    $(function() {
      add_thing_id_to_cookie('${thing.link._fullname}', 'recentclicks');
    });
  </script>
  <span>
    ${score(thing.link, thing.link.likes, score_fmt = Score.safepoints, tag='b')}
  </span>
  <span class="arrows">
    <%def name="arrow(direction, style, message)">
      <a class="arrow ${direction + style}"
         title="${_('vote %(direction)s') % dict(direction=direction)}"
       %if c.user_is_loggedin:
         href="javascript:void(0);"
         onclick="$(this).vote('${thing.vh}')"
       %else:
         href="${thing.loginurl}"
         target="_top"
         onclick="return toolbar.login_msg()"
       %endif
      >
        ${message}
      </a>
    </%def>

    ${arrow("up",   thing.upstyle,   _("like"))}
    ${arrow("down", thing.downstyle, _("dislike"))}
  </span>


  %if c.user_is_loggedin:
    %if thing.link.saved:
      ${state_button("unsave", _("unsave"),
        "return change_state(this, 'unsave');", "<b>%s</b>" % _("unsaved"),
        a_class="clickable")}
    %else:
       ${state_button("save", _("save"),
         "return change_state(this, 'save');", "<b>%s</b>" % _("saved"),
         a_class="clickable")}
    %endif
  %endif

  <a href="/toolbar/comments/${thing.link._id36}" target="reddit_panel"
     title="${_('toggle the comments panel')}"
     onclick="toolbar.comments_pushed(this); return toolbar.panel_loadurl(this.href);"
     class="comments comments-button">${thing.com_label}</a>
  </span>

  %if thing.link and thing.expanded:
    <script type="text/javascript">
      $(function() {
        toolbar.comments_pushed($('.comments-button'));
      });
    </script>
  %endif
</%def>
